!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},r=Error().stack;r&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[r]="d3863769-b630-497f-aa93-615076671c0d",e._sentryDebugIdIdentifier="sentry-dbid-d3863769-b630-497f-aa93-615076671c0d")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3631],{18522:function(e,r,a){a.d(r,{$O:function(){return s},L6:function(){return d},bX:function(){return l},i_:function(){return u}});var t=a(59838),n=a(14633),o=a.n(n),i=a(26249),c=a.n(i);function d(e,r){let a=[];for(let n of e){let{key:e,type:o}=n,i=r[e];if(void 0!==i)try{"number"===o?i=(0,t.kE)(i)?parseInt(i,10):void 0:"boolean"===o&&(i=JSON.parse(i))}catch(e){i=void 0}a.push(i)}return a}o()((e,r)=>{if(e===c().pathname){s(r);return}if(!Object.keys(r).length){c().push(e,{},{shallow:!0});return}let a=l(r);c().push(e+"?"+a)},200);let s=o()(e=>{let r=l(e);"?".concat(r)!==window.location.search&&c().replace(c().pathname+"?"+r,{search:r},{shallow:!0})},200);function l(e){let r={};for(let a of Object.keys(e)){let t=e[a];void 0!==t&&""!==t&&(r[a]=t.toString())}return new URLSearchParams(r).toString()}function u(e){window.location.href=e}},89542:function(e,r,a){a.d(r,{Q:function(){return t}});let t=a(45675).b1.feature("PaymentFacade")},68969:function(e,r,a){a.d(r,{h:function(){return c},x:function(){return d}});var t=a(89542),n=a(19997),o=a(57303),i=a(18522);function c(e){let{paymentOperation:r,purchaseTraceId:a,cameFromSource:o,cameFromSourcePayload:i,afterPaymentRedirectParams:c,routerQuery:d,specificPaymentOperationUrlParams:s}=e,l=new URLSearchParams({from:o,...s});if(c&&(l.set("redirect-fail",c.failRedirectUrl),l.set("redirect-success",c.successRedirectUrl),c.backUrl&&l.set("back-url",c.backUrl)),null==i?void 0:i.bookCardPayload){l.set("art-type",i.bookCardPayload.artType),l.set("author",i.bookCardPayload.author),l.set("book-slug",i.bookCardPayload.bookSlug);let e=String(null==i?void 0:i.bookCardPayload.isBundlePurchase)||"";e&&l.set("is-bundle-purchase",e)}if((null==i?void 0:i.seriesPayload)&&(l.set("series-url",i.seriesPayload.seriesUrl),l.set("series-id",i.seriesPayload.seriesId)),a&&l.set("trace-id",a),null==d?void 0:d.source)try{let e=(0,n.ps)(d);l.set("advertising",JSON.stringify(e))}catch(e){(0,t.Q)("FrontendLogicError","Cannot create JSON from advertising data ",{originalError:e}).emit()}return"/payment/".concat(r,"/?").concat(l.toString())}function d(e){let{orderInfo:r,cameFromSourcePayload:a,afterPaymentRedirectParams:c,routerQuery:d}=e,s={orderId:r.id,cameFromSource:r.cameFromSource,cameFromSourcePayload:null!=a?a:{},purchaseTraceId:r.purchaseTraceId,paymentMethodId:void 0,paymentSystemName:void 0,afterPaymentRedirectUrls:void 0,receiptEmail:void 0,hasPaymentBeenHandledOnExternalSite:void 0,advertisingData:void 0,appliedFeatureFlags:void 0,sudo:void 0};if(c&&(s.afterPaymentRedirectUrls={fail:c.failRedirectUrl,success:c.successRedirectUrl,backUrl:c.backUrl}),null==d?void 0:d.source)try{let e=(0,n.ps)(d);s.advertisingData=null!=e?e:void 0}catch(e){(0,t.Q)("FrontendLogicError","Cannot create JSON from advertising data ",{originalError:e}).emit()}let l=new o.f(s).getSearchParamsToWriteInUrl(),u=(0,i.bX)(l);return"/purchase/".concat(r.purchaseOperationType,"/?").concat(u)}},92249:function(e,r,a){a.d(r,{o:function(){return o}});var t=a(59838),n=a(44194);function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{onGoingToPayment:t.ZT},{onGoingToPayment:r}=e,[a,o]=(0,n.useState)(!1),i=(0,n.useRef)(null);return{goToPayment:(0,n.useCallback)(async e=>{if(!i.current){console.error("Need to pass paymentEntryPointControlRef to props of payment entry point component");return}e&&(e.stopPropagation(),e.preventDefault());let{isGoingToNewPaymentFrame:a,canGoToPayment:t}=i.current.goToPaymentOperation(e);o(a),await t?r():o(!1)},[r]),paymentEntryPointControlRef:i,isGoingToNewPaymentFrame:a}}},37656:function(e,r,a){a.d(r,{E:function(){return o},F:function(){return i}});var t=a(45675);let n=t.b1.feature("PaymentFrame"),o=(e,r,a,t)=>n(e,"".concat(r,": ").concat(a),t),i=(e,r)=>(0,t.Rg)(e)?e:e instanceof Error?o("FrontendLogicError",r,"Unhandled Error",{originalError:e}):o("FrontendLogicError",r,"Unhandled error with unexpected format")},55064:function(e,r,a){var t,n;a.d(r,{Z:function(){return t}}),(n=t||(t={})).method="method",n.system="system",n.order="order",n.from="from",n.artType="art-type",n.author="author",n.bookSlug="book-slug",n.seriesUrl="series-url",n.seriesId="series-id",n.traceId="traceId",n.redirectFail="redirect-fail",n.redirectSuccess="redirect-success",n.backUrl="back-url",n.email="email",n.hasPaymentBeenHandledOnExternalSite="has-payment-been-handled-on-external-site",n.advertising="advertising",n.sudo="sudo",n.flags="flags"},19997:function(e,r,a){a.d(r,{Ae:function(){return c},Qy:function(){return i},ps:function(){return o},xG:function(){return d}});var t=a(44731),n=a(45675);function o(e){return e.source?{banner_title:e.banner_title,banner_id:e.banner_id,place_slug:e.place_slug,source:e.source,campaign_id:e.campaign_id,adv_art_id:e.adv_art_id,promo_art_position:e.promo_art_position,app_id:e.app_id,platform:e.platform}:null}function i(e,r){try{let a=o(r);if(!a)return e;let t=new URLSearchParams;Object.keys(a).forEach(e=>{void 0!==a[e]&&t.set(e,a[e])});let n=e.includes("?");return e+(n?"&":"?")+t.toString()}catch(r){return(0,n.pW)("FrontendLogicError","Proxying advertising params",{originalError:r}).emit(),e}}function c(e){let{advertisingDataFromUrl:r,mmType:a,price:t,purchaseTraceId:o}=e,i=null;if("banners"===r.source)i={mm_type:a,block_type:"banners",revenue:t,campaign_id:Number(r.campaign_id)||0,app_id:r.app_id||"115",banner_id:Number(r.banner_id)||0,block_name:r.place_slug||"",block_title:r.banner_title||"",place_slug:r.place_slug||"",ad_campaign_id:Number(r.campaign_id)||0,purchase_trace_id:o||""};else{if("art"!==r.source)return(0,n.pW)("AnalyticsError","Getting info  advertising info",{originalError:"unknown source: ".concat(r.source)}).emit(),null;i={mm_type:a,block_type:"art",revenue:t,ad_campaign_id:Number(r.campaign_id)||0,adv_art_id:Number(r.adv_art_id)||0,platform:r.platform||"",campaign_id:Number(r.campaign_id)||0,promo_art_position:r.promo_art_position||"",purchase_trace_id:o||""}}return i}function d(e){try{t.TM.sendEventTyped("adv_banner_buy",e)}catch(e){throw(0,n.pW)("AnalyticsError","Sending litres tracker event from state machine",{originalError:e})}}},57303:function(e,r,a){a.d(r,{f:function(){return i}});var t=a(18522),n=a(55064),o=a(9360);class i{save(){(0,t.$O)(this.getSearchParamsToWriteInUrl())}getSearchParamsToWriteInUrl(){var e;let{data:r}=this,a={[n.Z.order]:r.orderId,[n.Z.traceId]:r.purchaseTraceId,[n.Z.method]:r.paymentMethodId,[n.Z.system]:r.paymentSystemName,[n.Z.from]:r.cameFromSource,[n.Z.email]:r.receiptEmail,[n.Z.hasPaymentBeenHandledOnExternalSite]:void 0,[n.Z.artType]:void 0,[n.Z.author]:void 0,[n.Z.bookSlug]:void 0,[n.Z.seriesUrl]:void 0,[n.Z.seriesId]:void 0,[n.Z.redirectFail]:void 0,[n.Z.redirectSuccess]:void 0,[n.Z.backUrl]:void 0,[n.Z.advertising]:r.advertisingData?JSON.stringify(r.advertisingData):void 0,[n.Z.sudo]:void 0,[n.Z.flags]:void 0};return r.hasPaymentBeenHandledOnExternalSite&&(a[n.Z.hasPaymentBeenHandledOnExternalSite]=!0),r.cameFromSourcePayload.bookCardPayload&&(a[n.Z.artType]=r.cameFromSourcePayload.bookCardPayload.artType,a[n.Z.author]=r.cameFromSourcePayload.bookCardPayload.author,a[n.Z.bookSlug]=r.cameFromSourcePayload.bookCardPayload.bookSlug),r.cameFromSourcePayload.seriesPayload&&(a[n.Z.seriesUrl]=r.cameFromSourcePayload.seriesPayload.seriesUrl,a[n.Z.seriesId]=r.cameFromSourcePayload.seriesPayload.seriesId),r.afterPaymentRedirectUrls&&(a[n.Z.redirectFail]=r.afterPaymentRedirectUrls.fail,a[n.Z.redirectSuccess]=r.afterPaymentRedirectUrls.success,r.afterPaymentRedirectUrls.backUrl&&(a[n.Z.backUrl]=r.afterPaymentRedirectUrls.backUrl)),!0===r.sudo&&(a[n.Z.sudo]=!0),(null===(e=r.appliedFeatureFlags)||void 0===e?void 0:e.length)&&(a[n.Z.flags]=(0,o.g)(r.appliedFeatureFlags.filter(e=>"default-value"!==e.source))),a}constructor(e){this.data=e}}},9360:function(e,r,a){a.d(r,{P:function(){return o},g:function(){return n}});var t=a(37656);function n(e){return e.map(e=>"".concat(e.key).concat("~").concat(e.value).concat("~").concat(e.source)).join("__")}function o(e){try{return e.split("__").filter(e=>3===e.split("~").length).map(e=>{let[r,a,t]=e.split("~");return{key:r,value:a,source:t}})}catch(e){return(0,t.E)("DataFromBrowserHandling","Feature Flag Utils","Failed to deserialize feature flags",{originalError:e}).emit(),[]}}}}]);
//# sourceMappingURL=3631-ff9613c013489e92.js.map