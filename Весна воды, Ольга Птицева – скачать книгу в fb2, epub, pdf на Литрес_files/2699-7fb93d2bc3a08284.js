!function(){try{var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},e=Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="8e0dfc1d-54d9-4c07-95b4-d136c80eab6d",t._sentryDebugIdIdentifier="sentry-dbid-8e0dfc1d-54d9-4c07-95b4-d136c80eab6d")}catch(t){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2699],{58689:function(t,e,n){n.d(e,{Ah:function(){return T},Cv:function(){return b},Ds:function(){return m},MZ:function(){return _},NT:function(){return v},Ne:function(){return S},OT:function(){return d},Pt:function(){return I},QU:function(){return P},Qm:function(){return o},RW:function(){return g},WZ:function(){return D},X8:function(){return L},fK:function(){return N},qg:function(){return w}});var i=n(59838),r=n(51618);let a={PAYONLINE:"32"},o={...a},s={"UNLIMIT EUR":"118"},u={"UNLIMIT TRY":"120"},l={"UNLIMIT AZN":"122"},c={"UNLIMIT USD":"8"},d={...s,...l,...u,...c},p={"PAYPAL PLN":"83"},f={"PAYPAL EUR":"84"},v={...f,...p,"PAYPAL USD":"93"},h={SBER_PAY_V1:"116"},_={SBER_PAY_V2:"121"},b={sbp:"123"},m={BLIK:"100"},P={...h,..._},g={...s,...a,..._,...v},y={...f},w={...c,...v},A={...m,...p},I={...l,...v},S={...u,...v},O={...g,...y,...A,...I,...S},T={...b,...f,...h,...O},L={QIWI:"104","QIWI NEW":"110",...O},N={[r.I.sbersbp]:{[i.pF.ru]:b.sbp},[r.I.sberspasibo]:{[i.pF.ru]:h.SBER_PAY_V1},[r.I.payonline]:{[i.pF.ru]:o.PAYONLINE},[r.I.sbercard]:{[i.pF.ru]:_.SBER_PAY_V2},[r.I.unlimit]:{[i.pF.ru]:d["UNLIMIT EUR"],[i.pF.az]:d["UNLIMIT AZN"],[i.pF.en]:d["UNLIMIT USD"],[i.pF.tr]:d["UNLIMIT TRY"]},[r.I.paypal]:{[i.pF.ru]:v["PAYPAL EUR"],[i.pF.uz]:v["PAYPAL EUR"],[i.pF.tr]:v["PAYPAL EUR"],[i.pF.en]:v["PAYPAL USD"],[i.pF.pl]:v["PAYPAL PLN"]},[r.I.qiwi]:{[i.pF.ru]:L["QIWI NEW"]},[r.I.appstore]:{},[r.I.sberpay]:{},[r.I.unknown]:{}};function D(t){for(let[e,n]of Object.entries(N))for(let i of Object.values(n||{}))if(i===t)return e}},51618:function(t,e,n){var i,r,a,o;n.d(e,{I:function(){return r},k:function(){return i}}),(a=i||(i={})).PayOnline="PayOnline",a.Unlimit="Unlimit",a.SberPay="SberPay",a.SberSpasibo="SberSpasibo",a.SberCard="SberCard",a.PayPal="PayPal",a.sbp="sbp",(o=r||(r={})).payonline="payonline",o.sbercard="sbercard",o.sbersbp="sbersbp",o.sberspasibo="sberspasibo",o.sberpay="sberpay",o.paypal="paypal",o.unlimit="unlimit",o.qiwi="qiwi",o.appstore="appstore",o.unknown="unknown"},14628:function(t,e,n){n.d(e,{$:function(){return r}});var i=n(8364);class r extends i.I{constructor(t){super(t),this.startSinceMonths=t.start_since_months,this.isActive=1===this.startSinceMonths}}},54105:function(t,e,n){n.d(e,{J:function(){return o}});var i=n(23340),r=n(97869);class a{constructor(t){this.id=t.id,this.tariffs=(null==t?void 0:t.tariffs.length)?null==t?void 0:t.tariffs.map(function(t){return new r.X(t)}):null}}class o{getStatus(){var t;let e="off";return(null===this||void 0===this?void 0:this.isActive)&&(e="active"),(null===this||void 0===this?void 0:null===(t=this.activeSubscription)||void 0===t?void 0:t.gracePeriod.isActive)===!0&&(e="active_in_grace"),e}getTheOnlyPlanOneMonthTariff(){var t,e,n;return(null===this||void 0===this?void 0:null===(t=this.availablePlans)||void 0===t?void 0:t.length)&&null!==(n=null===(e=this.availablePlans[0].tariffs)||void 0===e?void 0:e.find(t=>1===t.duration))&&void 0!==n?n:null}getAvailableTariff(t){var e,n,i;return(null===(e=this.availablePlans)||void 0===e?void 0:e.length)&&null!==(i=null===(n=this.availablePlans[0].tariffs)||void 0===n?void 0:n.find(e=>e.id===t))&&void 0!==i?i:null}activateOptimisticallyOnClientSide(){var t,e,n;this.isActive=!0,this.status="active";let r=(null===(t=this.getTheOnlyPlanOneMonthTariff())||void 0===t?void 0:t.id)||0,a=(null===(e=this.getTheOnlyPlanOneMonthTariff())||void 0===e?void 0:e.prices.totalPrice.currency)||"RUB",o=(null===(n=this.getTheOnlyPlanOneMonthTariff())||void 0===n?void 0:n.prices.totalPrice.value)||0,s=new Date,u=new Date(s);u.setMonth(s.getMonth()+1),this.availablePlans=[],this.activeSubscription=new i.hx({arts:{any_arts:{max_price:{amount:700,currency:a},amount:1},renew_at:u.toISOString(),special_set_arts:2},cumulative_discount_percentage:[{is_active:!0,start_at:s.toISOString(),value:10}],expired_at:u.toISOString(),grace_period:{is_active:!1,start_at:u.toISOString()},offer_id:1,purchase_origin:0,renew:{date:u.toISOString(),duration:1,price:{amount:o,currency:a},tariff_id:r,status:1},rebill_id:1})}constructor(t){this.isActive=!!t.is_active,this.activeSubscription=t.active_subscription?new i.hx(t.active_subscription):null,this.availablePlans=t.available_plans?t.available_plans.map(t=>new a(t)):null,this.status=this.getStatus(),this.isActivatedOnClientSide=!1}}},97869:function(t,e,n){n.d(e,{X:function(){return u}});var i=n(2327),r=n(34871),a=n(81014),o=n(52887),s=n(14628);class u{calculateDiscountPercentage(){return this.prices.discount?(0,o.G)(this.prices.priceWithoutDiscount.value,this.prices.totalPrice.value):new o.$(0)}getProlongationsInfo(){let{duration:t,prices:e,appliedCoupon:n}=this,i=new Date,r=new Date(i);r.setMonth(i.getMonth()+t);let a={date:u.formatDate(r),price:e.priceWithoutDiscount},o={firstProlongation:a};if(!n&&e.totalPrice.equal(a.price))return o;if((null==n?void 0:n.bonusMonthsCount)&&n.bonusMonthsCount>0){let t=new Date(i);t.setMonth(t.getMonth()+n.bonusMonthsCount),a.date=u.formatDate(t)}return o}static formatDate(t){let e=(0,i.K)("ru-RU");return(0,r.WU)(t,"d MMMM yyyy",{locale:e})}constructor(t){var e,n,i,r,o,u,l;this.id=t.id,this.prices={totalPrice:new a.W(t.prices.total_price),discount:t.prices.discount?new a.W(t.prices.discount):null,priceWithoutDiscount:new a.W(t.prices.price_without_discount)},this.duration=t.duration,this.appliedCoupon=t.applied_coupon?{type:null===(e=t.applied_coupon)||void 0===e?void 0:e.type,value:null===(n=t.applied_coupon)||void 0===n?void 0:n.value,bonusMonthsCount:(null===(i=t.applied_coupon)||void 0===i?void 0:i.bonus_months_count)||null}:null,this.promoEvent=t.promo_event||null,this.profits={arts:{anyArts:{amount:null===(r=t.profits)||void 0===r?void 0:r.arts.any_arts.amount,maxPrice:new a.W(null===(o=t.profits)||void 0===o?void 0:o.arts.any_arts.max_price)},specialSetArts:null===(u=t.profits)||void 0===u?void 0:u.arts.special_set_arts},cumulativeDiscounts:(null===(l=t.profits)||void 0===l?void 0:l.cumulative_discount_percentage).map(t=>new s.$({start_since_months:t.since_months,value:t.value}))}}}},23340:function(t,e,n){n.d(e,{h2:function(){return a},hx:function(){return l},ti:function(){return o}});var i,r,a,o,s=n(81014),u=n(36675);(i=a||(a={}))[i.OFF=0]="OFF",i[i.ON=1]="ON",(r=o||(o={}))[r.WEB=0]="WEB",r[r.APP_STORE=1]="APP_STORE",r[r.GOOGLE_PLAY=2]="GOOGLE_PLAY",r[r.PARTNER=3]="PARTNER";class l{getActiveCumulativeDiscount(){return this.cumulativeDiscountList.find(t=>t.isActive)||null}getExpiredDateText(t){return this.expiredAt?new Date(this.expiredAt).toLocaleDateString(t,{year:"numeric",month:"long",day:"numeric"}).replace(" г.",""):""}getCurrentPurchaseOriginName(){return["Web","AppStore","Google Play","Partner"][this.purchaseOrigin]}checkIfBoughtByApp(){return!(1!==this.purchaseOrigin&&2!==this.purchaseOrigin)}constructor(t){this.offerId=t.offer_id,this.rebillId=t.rebill_id||null,this.expiredAt=new Date(t.expired_at),this.renew={status:t.renew.status||0,tariffId:t.renew.tariff_id,price:new s.W(t.renew.price),date:new Date(t.renew.date),duration:t.renew.duration},this.cumulativeDiscountList=t.cumulative_discount_percentage.map(t=>new u.q(t)).sort((t,e)=>t.value-e.value),this.purchaseOrigin=t.purchase_origin,this.gracePeriod={isActive:t.grace_period.is_active,startAt:t.grace_period.start_at?new Date(t.grace_period.start_at):null},this.arts={renewAt:new Date(t.arts.renew_at),specialSetArts:t.arts.special_set_arts||0,anyArts:{amount:t.arts.any_arts.amount||0,maxPrice:new s.W(t.arts.any_arts.max_price)}},this.country=t.country||"RU"}}},56469:function(t,e,n){n.d(e,{Z:function(){return o},g:function(){return s}});var i=n(44194),r=n(61794),a=n(54105);function o(){let t=r.ce.useGetUserAbonementInfoQuery(null),e=(0,i.useMemo)(()=>t.data?new a.J(t.data):null,[t.data]);return{...t,data:e,error:t.error||null}}function s(){return o().data}},42699:function(t,e,n){n.d(e,{L:function(){return P},i:function(){return g}});var i=n(31549),r=n(44194),a=n(61794),o=n(59838),s=n(26249),u=n.n(s),l=n(58689),c=n(97933),d=n(56469),p=n(52887),f=n(19997),v=n(58117),h=n(68969);let _="go-to-abonement-payment",b="abonement_landing_views",m="/abonement",P=(0,r.memo)((0,r.forwardRef)((t,e)=>{let n=(0,a.CG)(t=>t.face.language||o.pF.ru),{data:r}=(0,d.Z)();if(!r)return null;let s=r.getTheOnlyPlanOneMonthTariff();if(!s)return null;let{totalPrice:u,priceWithoutDiscount:l}=s.prices;return(0,i.jsx)(y,{...t,totalPrice:u,priceWithoutDiscount:l,duration:s.duration,discountPercentage:s.calculateDiscountPercentage(),selectedTariffId:s.id,country:n.toUpperCase(),shouldGoToAbonementLandingIfNeed:(0,o.s7)(n),ref:e})}));P.displayName="AbonementOneMonthTariffPayment";let g=(0,r.memo)((0,r.forwardRef)((t,e)=>{var n,r;let{data:a}=(0,d.Z)();if(!(null==a?void 0:null===(n=a.activeSubscription)||void 0===n?void 0:n.renew))return null;let{duration:o,price:s,tariffId:u}=a.activeSubscription.renew;return(0,i.jsx)(y,{...t,artUrl:t.artUrl,totalPrice:s,priceWithoutDiscount:s,duration:o,discountPercentage:new p.$(0),selectedTariffId:u,country:null==a?void 0:null===(r=a.activeSubscription)||void 0===r?void 0:r.country,shouldGoToAbonementLandingIfNeed:!1,ref:e})}));g.displayName="AbonementRenewPayment";let y=(0,r.memo)((0,r.forwardRef)((t,e)=>{let{artUrl:n,discountPercentage:o,duration:d,selectedTariffId:p,priceWithoutDiscount:f,totalPrice:v,country:b,shouldGoToAbonementLandingIfNeed:m}=t,P=(0,s.useRouter)(),g=(0,a.CG)(t=>t.browser.pda),y=(0,a.CG)(t=>t.foundationUser),I=0!==y.id,[S,O]=(0,r.useState)(!1),T=(0,a.TL)(),L=I&&"RU"===b,N=(0,r.useMemo)(()=>{let t={mode:"buy_subscribe",offer_campaign:"11",offer_class:p.toString(),subscr_month:d.toString(),ref_url:n||"",is_next:"1"};return g&&(t.descr=l.Ah.PAYONLINE),t.summ=v.value.toString(),o.checkIfPositive()&&(t.next_price=f.value.toString(),100===o.value&&(t.free_subscription="1")),t},[n,o,d,g,p,f.value,v.value]),D=()=>{O(!1)},U=(0,r.useCallback)(()=>{if(g){let t=new URLSearchParams(N);window.location.href="/pages/put_money_on_account/?".concat(t.toString())}else O(!0)},[N,g]),M=(0,r.useCallback)(()=>{let e=function(t){let{selectedTariffId:e,cameFromSource:n,cameFromSourcePayload:i,afterPaymentRedirectParams:r,routerQuery:a}=t;return(0,h.h)({cameFromSource:n,cameFromSourcePayload:i,afterPaymentRedirectParams:r,paymentOperation:"abonement",routerQuery:a,specificPaymentOperationUrlParams:{tariff:e.toString()}})}({...t,routerQuery:P.query});return u().push(e),{canPay:!0}},[t,P.query]),R=(0,r.useCallback)(()=>{if(m){let{isGoingToAbonementLanding:t}=w(P.query);if(t)return{canPay:!1}}if(L){let{canPay:t}=M();return{canPay:t}}return U(),{canPay:!0}},[M,U,L,m,P.query]);return(0,r.useImperativeHandle)(e,()=>({goToPaymentOperation(){if(0===y.id)return T(a.hi.global.interfaceRequests.setLoginPopupError({isOpen:!0,errorText:"Авторизуйтесь для покупки абонемента",urlParams:{[_]:"1","block-phone-asking":"1"}})),{isGoingToNewPaymentFrame:!1,canGoToPayment:Promise.resolve(!1)};let{canPay:t}=R();return{isGoingToNewPaymentFrame:L,canGoToPayment:Promise.resolve(t)}}}),[T,y.id,R,L]),A(R),(0,i.jsx)(c.T,{isOpen:S,onClose:D,onShow:D,onHide:()=>{O(!0)},paymentData:N})})),w=t=>{if(u().pathname===m)return{isGoingToAbonementLanding:!1};let e=(0,o.ej)(b);if(Number(e)>=3)return{isGoingToAbonementLanding:!1};(0,o.d8)(b,"".concat(e?Number(e)+1:1));let n=(0,f.Qy)(m,t);return window.location.href=n,{isGoingToAbonementLanding:!0}},A=t=>{let e=(0,s.useRouter)(),n=(0,a.CG)(t=>t.foundationUser);(0,r.useEffect)(()=>{new URL(window.location.href).searchParams.has(_)&&(0===n.id||n.abonement.is_active||t(),(0,v.Ow)(e,[_]))},[n,e,t])}}}]);
//# sourceMappingURL=2699-7fb93d2bc3a08284.js.map