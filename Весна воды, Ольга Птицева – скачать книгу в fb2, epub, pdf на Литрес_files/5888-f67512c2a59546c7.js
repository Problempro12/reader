!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},a=Error().stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="c8bb78f9-2a3e-4cfa-9ee4-b971e8b8c57b",e._sentryDebugIdIdentifier="sentry-dbid-c8bb78f9-2a3e-4cfa-9ee4-b971e8b8c57b")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5888],{54675:function(e,a,i){"use strict";i.d(a,{_:function(){return R}});var t=i(31549),o=i(44194),l=i(14391),r=i(26249),n=i(48592),s=i(61794),d=i(77837),u=i.n(d),c=i(50249),_=i(70608);let v=e=>{var a,i;let{url:t,id:n,sortType:d,withReplyId:u,withReviewId:v,limitReviews:g,bookSubPath:p,pageFromPathParams:b}=e,[w,k]=(0,o.useState)(d||l.sf.popular),[m,f]=(0,o.useState)([]),[R,y]=(0,o.useState)(b),h=(0,r.useRouter)(),x=(0,o.useMemo)(()=>(0,_.uU)(h.asPath),[h.asPath]),P=e=>{let{page:a,sort:i}=e,t=1;return"number"==typeof a&&(t=a+1),c.stringifyUrl({url:"".concat(x.slug,"/").concat(x.subpage,"/"),query:{[l.Tx.PAGE]:t,[l.Tx.SORT]:i||h.query.sort||null}},{skipNull:!0})},[C]=s.dv.useLazyGetArtReviewsQuery(),{data:L,isFetching:I,refetch:N,isLoading:A}=s.dv.useGetArtReviewsQuery({artId:n,url:t,sortType:d,withReplyId:p?void 0:u,withReviewId:p?void 0:v,limit:g,offset:p?1===b?0:10*(b-1):void 0}),{data:E}=s.dv.useGetArtReviewsQuery({artId:n,url:t,withReplyId:u,withReviewId:v,limit:1},{skip:!p||!u&&!v}),T=null!==(a=null==L?void 0:L.payload.data)&&void 0!==a?a:[],S=null!==(i=null==E?void 0:E.payload.data)&&void 0!==i?i:[],D=[...1===R?S:[],...m.length?m:T],j=async e=>{var a;y(e.selected+1);let i=await C({artId:n,limit:10,offset:10*e.selected,sortType:d}).unwrap();f(null!==(a=null==i?void 0:i.payload.data)&&void 0!==a?a:[]);let t=P({page:e.selected});h.push(t,void 0,{shallow:!0,scroll:!1})};return d&&w!==d&&(N(),k(d),f([])),(0,o.useEffect)(()=>{I||f(e=>{var a;return[...t&&e?e:[],...null!==(a=null==L?void 0:L.payload.data)&&void 0!==a?a:[]]})},[t,I,null==L?void 0:L.payload.data]),{reviewList:D,pagination:null==L?void 0:L.payload.pagination,isLoading:I,isLoaded:A,page:R,setPage:y,resetPaginator:e=>{R>1&&y(1);let a=P({sort:e});h.push(a,void 0,{shallow:!0,scroll:!1})},updateReviewList:function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(a){d===l.sf.popular?f([...m,e]):f([e,...m]);return}let i=m.findIndex(a=>a.id===e.id),t=m.filter(a=>a.id!==e.id);t[i]=e,f(t)},changePaginatorPage:j}};var g=i(24810),p=i(15081),b=i(73758),w=i(52592);let k=e=>{let{updateReviewList:a}=e,[i,t]=(0,o.useState)(null),{art:l,artIdOrSlug:r}=(0,g.G)(),n=(0,s.TL)(),{user:d,callbacks:u}=(0,w.z)({updateReviewList:e=>{a(e)}}),[c,{isLoading:v}]=s.qL.useAddArtRatingMutation(),[p,{isLoading:k}]=s.qL.useDeleteArtRatingMutation(),[m,{isLoading:f}]=s.dv.useAddArtReviewMutation(),[R]=s.dv.useLazyGetUserArtReviewsQuery(),y=async()=>{var e,a;t(null!==(a=null===(e=(await R({artId:l.id,limit:1})).data)||void 0===e?void 0:e.payload.data[0])&&void 0!==a?a:null)},h=async e=>{try{let i=(await m({artId:l.id,text:e}).unwrap()).payload.data;return l.is_draft&&a(i,l.is_draft),await y(),i.id}catch(e){console.log(e)}},x=async e=>{var a;(null===(a=l.rating)||void 0===a?void 0:a.user_rating)===e?(await p({artId:l.id,artIdOrSlug:r}).unwrap(),n(s.hi.global.arts.setUserRating(0))):(await c({artId:l.id,rating:e,artIdOrSlug:r}).unwrap(),n(s.hi.global.arts.setUserRating(e)))};(0,o.useEffect)(()=>{d.userId&&y()},[d.userId,l.id]);let P=(e,a)=>{b.TM.sendEvent(["LITRES_TRACKER"],{eventType:e,params:(0,_.Eb)({art:l,extra:a})})};return{callbacks:{...u,onAddReview:h,onRatingClick:x,onClickAllReviews:()=>{P("book_card_reviews_page_click")},onClickWriteReview:()=>{P("book_card_review_write_attempt_click",{main:!0})},onSubmitReview:e=>{e?P("book_card_review_reply_success"):P("book_card_review_write_success")},onClickAnswerButton:()=>{P("book_card_review_reply_click")},onClickOptionsReview:()=>{P("book_card_review_options_click")},onClickComplainToReview:()=>{P("book_card_review_report_click")},onClickShareReview:()=>{P("book_card_review_share_click")},onWriteReview:e=>{"string"==typeof e&&1===e.trim().length&&P("book_card_review_write_attempt_click",{text:!0})},onClickLikeReview:(e,a)=>{var i;e||P("book_card_review_like_click"),null===(i=u.onClickLikeReview)||void 0===i||i.call(u,e,a)},onClickDislikeReview:(e,a)=>{var i;e||P("book_card_review_dislike_click"),null===(i=u.onClickDislikeReview)||void 0===i||i.call(u,e,a)},isAddRatingLoading:v,isDeleteRatingLoading:k,isAddReviewLoading:f},user:d,userReview:i,handleSendEventData:P}};var m=i(87135),f=i.n(m);let R=()=>{var e,a,i,d,c,b;let{t:w,i18n:m}=(0,n.$G)(),{art:R,bookSubPath:y,isDesktop:h}=(0,g.G)(),[x,P]=(0,o.useState)(""),[C,L]=(0,o.useState)(!1),I=(0,o.useRef)(null),N=(0,r.useRouter)(),{query:A}=N,E=(0,o.useMemo)(()=>(0,_.uU)(N.asPath),[N.asPath]),T=(null===(e=R.url)||void 0===e?void 0:e.endsWith("/"))?R.url.slice(0,R.url.length-1):R.url,S="",D="h4";if(y){D="h1";let e=(0,_.c4)(R)&&0!==R.podcast_episodes_count,a=(0,_.F0)(R)&&!(0,_.c4)(R),i=E.subpageParams.page,t=R.title;S=i>1?w(e?"Отзывы о подкасте \xab{bookName}\xbb, страница {page}":a?"Отзывы на аудиокнигу \xab{bookName}\xbb, страница {page}":"Отзывы на книгу \xab{bookName}\xbb, страница {page}",{bookName:t,page:i}):w(e?"Отзывы о подкасте \xab{bookName}\xbb":a?"Отзывы на аудиокнигу \xab{bookName}\xbb":"Отзывы на книгу \xab{bookName}\xbb",{bookName:t})}let j=y?f().bookReviews__title:"",G=y?"":T,W=A[l.Tx.SORT]||void 0,z=+(null!==(i=A[l.Tx.WITH_REPLY_ID])&&void 0!==i?i:0),M=+(null!==(d=A[l.Tx.WITH_REVIEW_ID])&&void 0!==d?d:0),[U,Q]=(0,o.useState)(z),[q,B]=(0,o.useState)(M),F=R.is_draft?l.sf.new:l.sf.popular,[O,H]=(0,o.useState)(W||F),V=(0,_.cV)(x,R.id),Y=V||y?10:5,{reviewList:Z,pagination:K,isLoading:$,page:J,setPage:X,updateReviewList:ee,resetPaginator:ea,changePaginatorPage:ei}=v({id:R.id,url:V||y?x:"",sortType:O,withReplyId:0===U?void 0:U,withReviewId:0===q?void 0:q,limitReviews:Y,bookSubPath:y,pageFromPathParams:E.subpageParams.page}),et=(0,s.CG)(e=>e.browser.pda),eo=!!y&&(!!(null==K?void 0:K.next_page)||!!(null==K?void 0:K.previous_page)),el=null!==(c=R.reviews_count)&&void 0!==c?c:0,er=Math.min(el-((y?10:5)+(J-1)*10),10),{user:en,userReview:es,handleSendEventData:ed,callbacks:eu}=k({updateReviewList:ee}),ec=()=>{if(I.current){let e=I.current.getBoundingClientRect().top+window.scrollY+(h?-144:-24);window.scrollTo({top:e,behavior:"smooth"}),L(!1)}},e_=()=>{!y&&(U&&Q(void 0),q&&B(void 0))};return(0,o.useEffect)(()=>{y&&C&&ec()},[C,y]),(0,t.jsx)("div",{ref:I,className:f().bookReviews,children:(0,t.jsx)(l.ZP,{title:{title:S,titleAs:D,titleClassName:j,linkToAllReviews:G||void 0,shouldShowReviewsCount:!y},entity:{id:R.id,name:R.title,type:l.mT.art,artUserRating:null!==(b=null===(a=R.rating)||void 0===a?void 0:a.user_rating)&&void 0!==b?b:void 0,isDraft:R.is_draft},user:en,callbacks:{...eu,onWriteReview:eu.onWriteReview?u()(eu.onWriteReview,500):void 0,onClickSorting:e=>{ed("book_card_reviews_rank_click",{by_new:l.sf.new===e,by_popularity:l.sf.popular===e}),H(e),P(""),e_(),y?ea(e):X(1)},onLoadNextReviews:()=>{ed("book_card_review_upload_more_click"),(null==K?void 0:K.next_page)&&(e_(),P(K.next_page),X(e=>e+1))},onChangePaginatorPage:e=>{ei(e),L(!0)}},reviewsData:{totalCount:el,list:Z,userReview:es},pagination:{shouldShowPaginator:eo,page:J,pageLimit:Y,nextPageCount:er,isLoadingMoreReviews:$},sorting:O,isPDA:et,lang:m.language,complainComponent:(0,t.jsx)(p.s,{})})})}},60838:function(e,a,i){"use strict";i.d(a,{D:function(){return p}});var t=i(31549),o=i(44194),l=i(51865),r=i.n(l),n=i(2832),s=i.n(n),d=i(59838),u=i(62094),c=i(4438),_=i(19565),v=i.n(_),g=i(39319);let p=e=>{let{pageCount:a=10,currentPage:i=1,pageRangeDisplayed:l=2,marginPagesDisplayed:n=1,disabledClassName:_,breakClassName:p,onChange:b=d.ZT,onClick:w,hrefBuilder:k,previousLabel:m,nextLabel:f,isSmall:R,isBreakClickEnable:y}=e,h=(0,u.Gc)("breakpoint-700"),x=R||h,P=(0,o.useRef)(null);return(0,o.useEffect)(()=>{var e;let a=()=>{var e,a;let i=P.current;if(!i)return;let t=i.closest("[class*='Paginator_container']");t&&t.setAttribute("aria-label","");let o=null===(a=i.parentNode)||void 0===a?void 0:null===(e=a.parentNode)||void 0===e?void 0:e.parentNode;if(!o)return;let l=o.querySelectorAll("[class*='Paginator_break'] a");null==l||l.forEach(e=>{e.setAttribute("tabindex","-1"),e.setAttribute("aria-label","")});let r=o.querySelectorAll("[class*='Paginator_page_active'] a");null==r||r.forEach(e=>{e.setAttribute("tabindex","0")})},i=new MutationObserver(a),t=null===(e=P.current)||void 0===e?void 0:e.closest("[class*='Paginator_container']");return t&&i.observe(t,{childList:!0,subtree:!0}),a(),()=>{t&&i.disconnect()}},[i]),(0,t.jsx)(s(),{pageCount:a,hrefBuilder:e=>e===i?null:k?k(e):1===e?".":"?page=".concat(e),containerClassName:r()(v().container,{[v().container_small]:R}),pageClassName:v().page,activeClassName:v().page_active,previousLabel:(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(g.z,{ref:P,mode:"tertiary",text:x?"":m,size:x?"small":"medium",icon:(0,t.jsx)(c.uQ,{name:"chevronLeft",size:24}),iconClassName:v().icon,className:v().button,e2eId:"paginator__previousLabel",tabIndex:-1})}),previousClassName:v().arrow,prevRel:null,previousAriaLabel:x?"":m,nextAriaLabel:x?"":f,nextRel:null,nextPageRel:null,nextLabel:(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(g.z,{mode:"tertiary",text:x?"":f,size:x?"small":"medium",icon:(0,t.jsx)(c.uQ,{name:"chevronRight",size:24}),iconPosition:"right",iconClassName:v().icon,className:v().button,e2eId:"paginator__nextLabel",tabIndex:-1})}),nextClassName:v().arrow,breakClassName:r()(v().page,v().break,p,{[v().break_clickEnable]:y}),breakLabel:"...",onPageChange:b,onClick:w,disabledClassName:r()(v().arrow_disabled,_),pageRangeDisplayed:l,marginPagesDisplayed:n,forcePage:i-1,ariaLabelBuilder:e=>"Страница ".concat(e)})}},87135:function(e){e.exports={bookReviews__title:"BookReviews-module__QUxj7W__bookReviews__title"}},19565:function(e){e.exports={container:"Paginator-module__g51rda__container",arrow:"Paginator-module__g51rda__arrow",button:"Paginator-module__g51rda__button",icon:"Paginator-module__g51rda__icon",page:"Paginator-module__g51rda__page",page_active:"Paginator-module__g51rda__page_active",break:"Paginator-module__g51rda__break",break_clickEnable:"Paginator-module__g51rda__break_clickEnable",container_small:"Paginator-module__g51rda__container_small",arrow_disabled:"Paginator-module__g51rda__arrow_disabled"}}}]);
//# sourceMappingURL=5888-f67512c2a59546c7.js.map