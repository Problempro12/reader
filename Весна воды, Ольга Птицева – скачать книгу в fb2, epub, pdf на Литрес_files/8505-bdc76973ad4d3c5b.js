!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="27e5ad26-68ef-41ac-8511-e74d8bc8d70a",e._sentryDebugIdIdentifier="sentry-dbid-27e5ad26-68ef-41ac-8511-e74d8bc8d70a")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8505],{2598:function(e,t,r){"use strict";function n(e){return void 0!==e.error}r.d(t,{$:function(){return n}})},89668:function(e,t,r){"use strict";r.d(t,{o:function(){return i}});var n=r(81014),a=r(52887);class i{get offerId(){return this.artBackendData.id.toString()}get offeredArtId(){return this.artBackendData.id}get offerReferralLinkUrl(){return this.artBackendData.referral_link||void 0}get currency(){var e;return(null===(e=this.artBackendData.prices)||void 0===e?void 0:e.currency)||"RUB"}get totalPrice(){var e;return new n.W((null===(e=this.artBackendData.prices)||void 0===e?void 0:e.final_price)||0,this.currency)}get fullPrice(){var e,t;return new n.W((null===(e=this.artBackendData.prices)||void 0===e?void 0:e.full_price)||0,(null===(t=this.artBackendData.prices)||void 0===t?void 0:t.currency)||"RUB")}get discountPercentage(){var e,t,r;return(null===(e=this.artBackendData.prices)||void 0===e?void 0:e.discount_percent)?new a.$(null!==(r=null===(t=this.artBackendData.prices)||void 0===t?void 0:t.discount_percent)&&void 0!==r?r:0):(this.totalPrice.lesserThen(this.fullPrice)&&(0,a.G)(this.fullPrice.value,this.totalPrice.value),new a.$(0))}get canBeFullyPaidByAccountMoney(){var e;return!!(null===(e=this.artBackendData.prices)||void 0===e?void 0:e.can_be_paid_by_account_money)}constructor(e){this.offerType="paper",this.artBackendData=e}}},63475:function(e,t,r){"use strict";r.d(t,{J:function(){return o}});var n=r(18370),a=r(52887),i=r(81014),s=r(49996);class o extends s.x{get offerId(){return this.artBackendData.id.toString()}get artId(){return this.artBackendData.id}get offerPageUrl(){return this.artBackendData.url||void 0}get currency(){var e;return(null===(e=this.artBackendData.prices)||void 0===e?void 0:e.currency)||"RUB"}get totalPrice(){var e;return new i.W((null===(e=this.artBackendData.prices)||void 0===e?void 0:e.final_price)||0,this.currency)}get earnedBonusesAmount(){var e;return(null===(e=this.artBackendData.prices)||void 0===e?void 0:e.earned_bonuses_amount)||0}get canEarnedBonusesAmountAfterSignUpLoyalty(){let e=this.artBackendData.prices;return(null==e?void 0:e.can_earned_bonuses_amount_after_sign_up_loyalty)||0}get priceWithBonus(){var e;return new i.W((null===(e=this.artBackendData.prices)||void 0===e?void 0:e.price_with_bonus)||0,this.currency)}get realMoneyInTotalPrice(){var e;return new i.W((null===(e=this.artBackendData.prices)||void 0===e?void 0:e.cost_with_bonus)||0,this.currency)}get discountInTotalPrice(){return this.getDiscountForArt()}get accountMoneyInTotalPrice(){return this.getAccountMoneyThatCanBeUsedForArt()}get fullPrice(){var e,t;return new i.W((null===(e=this.artBackendData.prices)||void 0===e?void 0:e.full_price)||0,(null===(t=this.artBackendData.prices)||void 0===t?void 0:t.currency)||"RUB")}get discountPercentage(){var e,t,r;return(null===(e=this.artBackendData.prices)||void 0===e?void 0:e.discount_percent)?new a.$(null!==(r=null===(t=this.artBackendData.prices)||void 0===t?void 0:t.discount_percent)&&void 0!==r?r:0):(this.totalPrice.lesserThen(this.fullPrice)&&(0,a.G)(this.fullPrice.value,this.totalPrice.value),new a.$(0))}get canBeFullyPaidByAccountMoney(){var e;return!!(null===(e=this.artBackendData.prices)||void 0===e?void 0:e.can_be_paid_by_account_money)}get isPodcastCollection(){return this.artBackendData.art_type===n.lG.podcast}get offeredItemsIds(){return[this.artBackendData.id]}get type(){switch(this.artBackendData.art_type){case 1:return"audio";case 22:return"podcast";case 23:return"podcast-part";case 25:return"webtoon";case 26:return"webtoon-part";default:return"text"}}get isDrm(){return this.artBackendData.is_drm||!1}get isDraft(){return this.artBackendData.is_draft||!1}get isArtForPreorder(){return"number"==typeof this.artBackendData.availability&&this.artBackendData.availability>1}get isAutoSpeechGift(){return this.artBackendData.is_auto_speech_gift}get podcastsLeftToBuy(){return this.artBackendData.podcast_left_to_buy||0}constructor(e){super(),this.artBackendData=e,this.offerType="one_art",this.getDiscountForArt=()=>{let e=this.artBackendData;if(!this.totalPrice.checkIfZero()&&this.discountPercentage.checkIfPositive()){var t,r;return new i.W(((null===(t=e.prices)||void 0===t?void 0:t.full_price)||0)-((null===(r=e.prices)||void 0===r?void 0:r.final_price)||0),this.currency)}return new i.W(0,this.currency)},this.getAccountMoneyThatCanBeUsedForArt=()=>{var e;let t=this.artBackendData;return!(null===(e=t.prices)||void 0===e?void 0:e.account_money)||this.totalPrice.checkIfZero()?new i.W(0,this.currency):t.prices.account_money<=this.totalPrice.value?new i.W(t.prices.account_money,this.currency):this.totalPrice}}}},3827:function(e,t,r){"use strict";r.d(t,{i:function(){return s}});var n=r(52887),a=r(81014),i=r(49996);class s extends i.x{get offerId(){return this.artWithoutBundle.offerId+"_bundle"}get artId(){return this.artWithoutBundle.artId}get sourceArtType(){return this.artWithoutBundle.type}get offerPageUrl(){return this.artWithoutBundle.offerPageUrl||void 0}get currency(){return this.bundleBackendData.currency||"RUB"}get totalPrice(){return new a.W(this.bundleBackendData.total_price_in_bundle,this.currency)}get realMoneyInTotalPrice(){let e=this.bundleBackendData.total_price_in_bundle;return this.accountMoneyInTotalPrice.checkIfPositive()&&this.accountMoneyInTotalPrice.lesserThen(this.totalPrice)&&(e=this.bundleBackendData.total_price_in_bundle-this.accountMoneyInTotalPrice.value),new a.W(e,this.currency)}get accountMoneyInTotalPrice(){return this.artWithoutBundle.accountMoneyInTotalPrice}get discountPercentage(){return new n.$(this.bundleBackendData.bundle_discount_percentage)}get fullPrice(){return new a.W(this.bundleBackendData.total_price_separately||0,this.currency)}get canBeFullyPaidByAccountMoney(){return!1}get artsCount(){return this.bundleBackendData.art_ids.length}get offeredItemsIds(){return this.bundleBackendData.art_ids}get priceWithBonus(){}get earnedBonusesAmount(){}get canEarnedBonusesAmountAfterSignUpLoyalty(){}constructor(e,t){super(),this.bundleBackendData=e,this.artWithoutBundle=t,this.offerType="bundle"}}},659:function(e,t,r){"use strict";r.d(t,{E:function(){return s}});var n=r(52887),a=r(81014),i=r(49996);class s extends i.x{get offerId(){return"cart"}get offerPageUrl(){return"/my-books/cart/"}get currency(){return this.cartStatusBackendData.final_cost.currency||"RUB"}get totalPrice(){return this.canBeFullyPaidByAccountMoney?this.accountMoneyInTotalPrice:new a.W(this.realMoneyInTotalPrice.value+this.accountMoneyInTotalPrice.value,this.currency)}get realMoneyInTotalPrice(){return this.canBeFullyPaidByAccountMoney?new a.W(0,this.currency):new a.W(this.cartStatusBackendData.final_cost.amount,this.currency)}get accountMoneyInTotalPrice(){return this.canBeFullyPaidByAccountMoney?new a.W(this.cartStatusBackendData.final_cost.amount,this.currency):new a.W(this.cartStatusBackendData.account_money.amount,this.currency)}get discountPercentage(){return(0,n.G)(this.cartStatusBackendData.final_cost.amount,this.cartStatusBackendData.base_cost.amount)}get fullPrice(){return new a.W(this.cartStatusBackendData.base_cost.amount||0,this.currency)}get canBeFullyPaidByAccountMoney(){return this.cartStatusBackendData.can_be_paid_by_account_money}get discount(){return this.cartStatusBackendData.discount.amount>0?new a.W(this.cartStatusBackendData.discount):null}get artsCount(){return this.cartStatusBackendData.count}get offeredItemsIds(){return this.cartStatusBackendData.arts_in_cart}get priceWithBonus(){return this.cartStatusBackendData.price_with_bonus?new a.W(this.cartStatusBackendData.price_with_bonus,this.currency):void 0}get earnedBonusesAmount(){return this.cartStatusBackendData.earned_bonuses_amount||void 0}get canEarnedBonusesAmountAfterSignUpLoyalty(){return this.cartStatusBackendData.can_earned_bonuses_amount_after_sign_up_loyalty||void 0}constructor(e,t){super(),this.cartStatusBackendData=e,this.firstArtUrl=t,this.offerType="cart"}}},80377:function(e,t,r){"use strict";r.d(t,{H:function(){return s}});var n=r(52887),a=r(81014),i=r(49996);class s extends i.x{get offerId(){return this.providedFromNewFrameData.offerId}get offerPageUrl(){return this.providedFromNewFrameData.offerPageUrl}get currency(){return this.providedFromNewFrameData.currency}get totalPrice(){return this.providedFromNewFrameData.totalPrice}get realMoneyInTotalPrice(){return this.providedFromNewFrameData.totalPrice}get fullPrice(){return this.totalPrice}get discountPercentage(){return new n.$(0)}get canBeFullyPaidByAccountMoney(){return!1}get accountMoneyInTotalPrice(){return new a.W(0,"RUB")}get offeredItemsIds(){return this.providedFromNewFrameData.offeredItemsIds}get seriesInfo(){return this.providedFromNewFrameData.seriesInfo}get priceWithBonus(){}get earnedBonusesAmount(){}get canEarnedBonusesAmountAfterSignUpLoyalty(){}constructor(e){super(),this.providedFromNewFrameData=e,this.offerType="old_frame_offer"}}},79892:function(e,t,r){"use strict";r.d(t,{s:function(){return s}});var n=r(52887),a=r(81014),i=r(49996);class s extends i.x{get offerId(){return this.artBackendData[0].id.toString()+"_pack"}get arts(){return this.artBackendData}get offerPageUrl(){return this.artBackendData[0].url||"/"}get currency(){var e;return(null===(e=this.artBackendData[0].prices)||void 0===e?void 0:e.currency)||"RUB"}get totalPrice(){return this.totalPriceData||new a.W(0,this.currency)}get realMoneyInTotalPrice(){return new a.W(0,this.currency)}get accountMoneyInTotalPrice(){return new a.W(0,this.currency)}get discountPercentage(){return new n.$(0)}get fullPrice(){return this.fullPriceData||new a.W(0,this.currency)}get canBeFullyPaidByAccountMoney(){return!1}get offeredItemsIds(){return this.artBackendData.map(e=>e.id)}get priceWithBonus(){}get earnedBonusesAmount(){}get canEarnedBonusesAmountAfterSignUpLoyalty(){}get packPresaleType(){return this.presaleType}constructor(e,t,r,n){super(),this.artBackendData=e,this.presaleType=t,this.totalPriceData=r,this.fullPriceData=n,this.offerType="art_pack"}}},41146:function(e,t,r){"use strict";r.d(t,{D:function(){return s}});var n=r(52887),a=r(81014),i=r(49996);class s extends i.x{get seriesId(){return this.seriesBackendData.id}get offerId(){return this.seriesBackendData.id+"_"+this.artsType}get offerPageUrl(){return this.seriesBackendData.url||void 0}get backendPrices(){if("audio"===this.artsType){if(!this.fullPricesBackendData.audio_arts_prices)throw Error("Series does not include info about audio arts prices");return this.fullPricesBackendData.audio_arts_prices}if(!this.fullPricesBackendData.text_arts_prices)throw Error("Series does not include info about audio arts prices");return this.fullPricesBackendData.text_arts_prices}get currency(){return this.uiCurrency}get totalPrice(){return new a.W(this.backendPrices.final_price,this.currency)}get realMoneyInTotalPrice(){return new a.W(this.totalPrice.value-this.accountMoneyInTotalPrice.value,this.currency)}get accountMoneyInTotalPrice(){return this.canBeFullyPaidByAccountMoney?new a.W(this.totalPrice.value,this.currency):new a.W(this.fullPricesBackendData.account_money,this.currency)}get discountPercentage(){return new n.$(this.backendPrices.discount_percent)}get fullPrice(){return new a.W(this.backendPrices.full_price,this.currency)}get canBeFullyPaidByAccountMoney(){return this.backendPrices.can_be_paid_by_account_money}get artsCount(){return this.backendPrices.arts_count}get offeredItemsIds(){return[this.seriesId]}get priceWithBonus(){return this.backendPrices.price_with_bonus?new a.W(this.backendPrices.price_with_bonus,this.currency):void 0}get earnedBonusesAmount(){return this.backendPrices.earned_bonuses_amount||void 0}get canEarnedBonusesAmountAfterSignUpLoyalty(){return this.backendPrices.can_earned_bonuses_amount_after_sign_up_loyalty||void 0}constructor(e,t,r,n){super(),this.artsType=e,this.uiCurrency=t,this.seriesBackendData=r,this.fullPricesBackendData=n,this.offerType="series"}}},49996:function(e,t,r){"use strict";r.d(t,{x:function(){return i}});var n=r(3224),a=r.n(n);class i{get canAccountMoneyBeUsedForPayment(){return this.accountMoneyInTotalPrice.checkIfPositive()}get isPriceReducedByAccountMoneyOrBonuses(){return[a()(this.earnedBonusesAmount)&&this.earnedBonusesAmount>0,this.canAccountMoneyBeUsedForPayment].some(e=>!0===e)}get isOneArt(){return 1===this.offeredItemsIds.length}}},90871:function(e,t,r){"use strict";r.d(t,{o:function(){return n}});class n{constructor(e){this.appDispatch=e}}},7053:function(e,t,r){"use strict";r.d(t,{q:function(){return p}});var n=r(11139),a=r(61794),i=r(2598),s=r(45675),o=r(63475),c=r(659),u=r(41146),l=r(3827),d=r(89668),h=r(83272),f=r(96681);class p extends f.l{static createPurchaseTraceId(){return(0,n.Z)()}async execute(e){let t="Create Order on backend",{offer:r,cameFromSource:n}=e,f=null;try{if(r instanceof o.J?f=r.isPodcastCollection?{type:"podcast_collection",podcast_collection_id:r.artId}:{type:"one_art",art_id:r.artId}:r instanceof c.E?f={type:"cart"}:r instanceof u.D?f={type:"series",media_type:r.artsType,series_id:r.seriesId}:r instanceof l.i?f={type:"bundle",art_ids:r.offeredItemsIds}:r instanceof d.o&&(f={type:"one_art",art_id:6375365}),!f)throw(0,s.Wz)("FrontendLogicError","unknown offer type ".concat(r.offerId," -> cannot create Order"));let p={offer:f,purchase_trace_id:e.purchaseTraceId,came_from_source:n,purchase_operation_type:"ppd"},y=await this.appDispatch(a.wQ.endpoints.createPurchasesOrder.initiate(p));if((0,i.$)(y))throw(0,s.Z1)("BackendInteractionError","".concat(t," request error"),{originalError:y.error});return new h.L(y.data).adapt()}catch(e){throw this.handleMutationError(e),(0,s.fs)(e,t)}}}},83272:function(e,t,r){"use strict";r.d(t,{L:function(){return s}});var n=r(52887),a=r(79583),i=r(81014);class s{adapt(){let{id:e,offer_type:t,purchase_trace_id:r,status:s,came_from_source:o,purchase_operation_type:c,currency:u,created_at:l,reserved_at:d,expired_at:h,discount:f,calculation:p,payment:y,issuance:m}=this.backendOrderInfo;return{id:e,offerType:t,purchaseTraceId:r,status:s,cameFromSource:null!=o?o:a.l.external,purchaseOperationType:c,currency:u,createdAt:new Date(l),reservedAt:d?new Date(d):null,expiredAt:h?new Date(h):null,discount:f?{discountPercentage:new n.$(f.discount_percentage),profitMoney:new i.W(f.profit_money)}:null,calculation:this.adaptCalculation(p,c),payment:this.adaptPayment(y),issuance:this.adaptIssuance(m)}}adaptCalculation(e,t){let r=[];return e.positions&&"ppd"===t&&(r=e.positions.map(e=>({positionType:"art",artId:e.art_id,artUrl:e.art_url,contentType:e.art_type,coverUrl:e.cover_url,authors:e.authors.map(e=>e.full_name),coverRatio:e.cover_ratio,title:e.title,discountedPrice:e.discounted_price?new i.W(e.discounted_price):new i.W(0,"RUB")}))),{fundsAllocation:{totalPrice:new i.W(e.funds_allocation.total_price),paymentMoney:new i.W(e.funds_allocation.payment_money),accountMoney:e.funds_allocation.account_money.amount,bonuses:e.funds_allocation.bonuses?{accountWhenKeep:e.funds_allocation.bonuses.account_when_keep,accountWhenSpend:e.funds_allocation.bonuses.account_when_spend,availableToSpend:e.funds_allocation.bonuses.available_to_spend,isSpendingEnabled:e.funds_allocation.bonuses.is_spending_enabled}:null},positions:r,totalPositionCount:e.total_position_count}}adaptPayment(e){var t,r,n,a,i,s;return e?{status:e.status,paymentSystemId:e.payment_system_id,createdAt:new Date(e.created_at),expiredAt:e.expired_at?new Date(e.expired_at):null,completedAt:e.completed_at?new Date(e.completed_at):null,deactivatedAt:e.deactivated_at?new Date(e.deactivated_at):null,paymentSystemCurrency:e.payment_system_currency,links:{paymentUiUrl:null!==(t=e.links.payment_ui_url)&&void 0!==t?t:null,successRedirectUrl:null!==(r=e.links.success_redirect_url)&&void 0!==r?r:null,failRedirectUrl:null!==(n=e.links.fail_redirect_url)&&void 0!==n?n:null},error:null!==(a=e.payment_error)&&void 0!==a?a:null,savedPaymentMethodId:null!==(i=e.saved_payment_method_id)&&void 0!==i?i:null,receiptEmail:null!==(s=e.receipt_email)&&void 0!==s?s:null}:null}adaptIssuance(e){return e?{status:e.status,issuedAt:e.issued_at?new Date(e.issued_at):null,error:e.issuance_error||null}:null}constructor(e){this.backendOrderInfo=e}}},96681:function(e,t,r){"use strict";r.d(t,{l:function(){return s}});var n=r(25868),a=r(90871),i=r(45675);class s extends a.o{handleMutationError(e){(0,i.Rg)(e)&&(0,n.p3)(e.originalError)&&(this.networkErrorCounter++,this.checkIfMaximumNumberLimitOfErrors()&&(e.extendedParams={skipEmit:!0}))}checkIfMaximumNumberLimitOfErrors(){return this.networkErrorCounter>i.TV}constructor(e){super(e),this.networkErrorCounter=0}}},55523:function(e,t,r){"use strict";r.d(t,{a:function(){return a}});var n=r(59838);function a(){return n.Ym&&!window.navigator.onLine}},89878:function(e,t,r){"use strict";var n,a,i,s,o,c;r.d(t,{KL:function(){return i},bG:function(){return a},iF:function(){return n}}),(s=n||(n={})).waiting_for_confirmation="waiting_for_confirmation",s.payment="payment",s.issuance="issuance",s.success="success",s.fail="fail",s.abort="abort",(o=a||(a={})).waiting="waiting",o.pending="pending",o.paid="paid",o.unpaid="unpaid",(c=i||(i={})).waiting="waiting",c.pending="pending",c.issued="issued",c.unissued="unissued"},24297:function(e,t,r){"use strict";r.d(t,{_:function(){return a}});var n=r(89878);class a{get totalPrice(){return this.calculation.fundsAllocation.totalPrice}get isCompleted(){return this.isSuccess||this.isFail||this.isAbort}get isSuccess(){return this.status===n.iF.success}get isAbort(){return this.status===n.iF.abort}get isFail(){return this.status===n.iF.fail}constructor(e){this.id=e.adaptedOrderBackendInfo.id,this.purchaseTraceId=e.adaptedOrderBackendInfo.purchaseTraceId,this.status=e.adaptedOrderBackendInfo.status,this.cameFromSource=e.adaptedOrderBackendInfo.cameFromSource,this.purchaseOperationType=e.adaptedOrderBackendInfo.purchaseOperationType,this.currency=e.adaptedOrderBackendInfo.currency,this.reservedAt=e.adaptedOrderBackendInfo.reservedAt,this.createdAt=e.adaptedOrderBackendInfo.createdAt,this.expiredAt=e.adaptedOrderBackendInfo.expiredAt,this.discount=e.adaptedOrderBackendInfo.discount,this.payment=e.adaptedOrderBackendInfo.payment,this.issuance=e.adaptedOrderBackendInfo.issuance,this.calculation=e.adaptedOrderBackendInfo.calculation,this.offerType=e.adaptedOrderBackendInfo.offerType}}},79558:function(e,t,r){"use strict";r.d(t,{A:function(){return i},F:function(){return a}});var n=r(55523);function a(e,t){let r="unhandled";if((0,n.a)())return"offline";switch(e){case"ArtsAreNotAvailableForPurchaseError":r="notAvailableAction";break;case"PositionsAlreadyIssued":r=t?"positionsAlreadyIssuedOneArt":"positionsAlreadyIssuedManyArts";break;case"PositionsNoLongerAvailable":r=t?"positionsNoLongerAvailableOneArt":"positionsNoLongerAvailableManyArts";break;case"CalculationUpdated":r="calculationUpdated";break;case"OrderExpired":r="orderExpired";break;case"PurchaseOrderNotFound":r="orderNotFound";break;default:r="unhandled"}return r}function i(e,t){let r={unhandled:t("Техническая ошибка"),offline:t("Отсутствует подключение к интернету"),notAvailableAction:t("Пожалуйста, обновите страницу и повторите запрос"),calculationUpdated:t("Количество средств на счете изменилось"),orderExpired:t("Истекло время оплаты заказа"),orderAborted:t("Заказ деактивирован"),orderFailed:t("Техническая ошибка"),orderNotFound:t("Заказ не найден"),positionsAlreadyIssuedOneArt:t("Книга уже куплена. Она доступна в разделе Мои Книги."),positionsAlreadyIssuedManyArts:t("Некоторые книги уже куплены. Посетите раздел Мои Книги, чтобы получить доступ к уже приобретенным материалам."),positionsNoLongerAvailableOneArt:t("Книга больше недоступна"),positionsNoLongerAvailableManyArts:t("Некоторые книги больше недоступны")};return r[e]||r.unhandled}},97933:function(e,t,r){"use strict";r.d(t,{T:function(){return l}});var n=r(31549),a=r(44194),i=r(56321),s=r(62094),o=r(59838),c=r(35660),u=r.n(c);let l=e=>{let{isOpen:t,onClose:r,onShow:o,onHide:c,paymentData:l}=e,d=(0,s.vI)("payment"),f=(0,a.useRef)(null);return((0,a.useEffect)(()=>{window.Payment={setHeight:e=>{f.current&&(f.current.style.height=String(e)+"px")},iframe:f.current,close:r,hide:c,show:o,delete:r};let e=e=>{"Escape"===e.key&&r()};return t&&(document.addEventListener("keydown",e),document.body.style.overflowY="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflowY="auto",window.Payment=void 0}},[t]),t)?(0,i.createPortal)((0,n.jsx)("div",{className:u().payment,onClick:e=>{let t=e.target;t===f.current||t.closest("#payment-frame-popup")||r()},style:t?{}:{visibility:"hidden"},children:(0,n.jsx)("div",{className:u().payment__inner,children:(0,n.jsx)("iframe",{id:"payment-frame-popup",src:h(l),ref:f,title:"Payment popup"})})}),d):(0,n.jsx)(n.Fragment,{})},d=()=>o.Ym&&window.location.host.includes("litres")&&!window.location.host.includes("stage.ssr.b")?window.location.protocol+"//"+window.location.hostname:"https://www.litres.ru",h=e=>{let t=new URL("".concat(d(),"/pages/paymentpopup/?is_next=1"));for(let r in e)t.searchParams.append(r,String(e[r]));return t.toString()}},19331:function(e,t,r){"use strict";r.d(t,{l:function(){return l}});var n=r(31549);r(44194);var a=r(34270),i=r(48592),s=r(25868),o=r(79558),c=r(21958),u=r.n(c);function l(e){let{isShown:t,error:r,isOneArtPurchase:c,onClose:l,onRetry:d,alignElementRef:h}=e,{t:f}=(0,i.$G)(),p=(0,s.HA)(r)&&(0,s.i3)(r.originalError)?r.originalError.data.error.type:"unknown",y=(0,o.F)(p,c),m=(0,o.A)(y,f),_=["offline","unhandled"].includes(y)?"retry":"update-screen",g="retry"===_?d:()=>{window.location.reload()};return(0,n.jsx)(a.P,{isOpen:t,title:f("Не удалось перейти к покупке"),onClose:l,alignElRef:h,horizontalAlign:"right",verticalAlign:"bottom",mode:"info",message:m,button:{label:"retry"===_?"Попробовать ещё раз":"Обновить",onClick:g},buttonClassName:u().tryAgain,time:1e4})}},98505:function(e,t,r){"use strict";r.d(t,{S:function(){return N}});var n=r(31549),a=r(44194),i=r(91270),s=r(61794),o=r(59838),c=r(26249),u=r(76791),l=r(25868),d=r(97933),h=r(2598),f=r(15381),p=r(89542),y=r(659),m=r(41146),_=r(63475),g=r(3827),v=r(59187),k=r(7053),P=r(24297),B=r(79892),w=r(19331),b=r(48592),I=r(9524);function A(e){let{isShown:t,onSubmit:r,onClose:a,accountMoney:i}=e,{t:s}=(0,b.$G)();return(0,n.jsxs)(I.u_,{title:s("Сообщение"),isOpen:t,onClose:a,primaryButton:{label:s("ОК"),onClick:r},secondaryButton:{label:s("Отмена"),onClick:a},closeOnClickOutside:!0,children:[s("Сейчас с вашего счета в книжном магазине будет списано {accountMoney}",{accountMoney:i.toStringWithCurrency()}),".",(0,n.jsx)("br",{}),s("Продолжить"),"?"]})}var D=r(44731),T=r(29566),S=r(80377),E=r(19997);let C=e=>{let{ppdOffer:t,cameFromSource:r,afterPaymentRedirectParams:n,purchaseTraceId:o,onErrorPayment:u,onSuccessPaymentViaAccount:l,onCustomSetCreation:d}=e,h=(0,i.useDispatch)(),f=(0,s.CG)(e=>e.browser.pda),g=(0,c.useRouter)(),[v,k]=(0,a.useState)({}),P="/my-books/purchased/",[B,w]=(0,a.useState)(!1),b=(0,a.useCallback)(e=>{let t={...function(e,t,r,n){let a={is_next:1},i=F(top.location.href||window.location.href);return a.mode="default",i.epay&&(a.epay=i.epay),r&&(a["redirect-fail"]=r.failRedirectUrl,a["redirect-success"]=r.successRedirectUrl),n&&(a.purchase_trace_id=n),a}(0,0,n,o),...e};if(f){let e=new URLSearchParams(t);window.location.href="/pages/put_money_on_account/?".concat(e)}else k(t),w(!0)},[n,r,f,o]),I=(0,a.useMemo)(()=>({artsIds:t.offeredItemsIds,cameFromSource:r,purchaseTraceId:o||"",price:t.totalPrice.value,currency:t.currency}),[t,o,r]),A=(0,a.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;x({eventType:T.s.paymentFailed,customSetId:e,...I}),u()},[I,u]),C=(0,a.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;x({eventType:T.s.paymentSuccess,customSetId:e,...I}),function(e,t){let r=(0,E.ps)(e);if(!r)return;let n=(0,E.Ae)({advertisingDataFromUrl:r,mmType:D.a4.ppd,price:t||0});n&&(0,E.xG)(n)}(g.query,I.price),l?l():window.location.reload()},[I,l,g.query]),M=(0,a.useCallback)(e=>{h(s.hi.payment.doOrder({customSetId:e,onSuccess:t=>{let{response:r}=t;(null==r?void 0:r.status)==="error"?A(e):(C(),n&&""!==n.successRedirectUrl&&g.push(n.successRedirectUrl))},onError:()=>{A(e)}}))},[n,h,A,C,g]),U=(0,a.useCallback)(e=>{var r,n;let{response:a}=e;if(d(),!t.canBeFullyPaidByAccountMoney&&(null==a?void 0:null===(r=a.custom_set)||void 0===r?void 0:r.id)){let e={ref_url:t.offerPageUrl||""};1!==t.offeredItemsIds.length||t instanceof m.D!=!1||t instanceof _.J&&t.isPodcastCollection||f?e.custom_set=a.custom_set.id.toString():e.art=t.offeredItemsIds[0].toString(),b(e)}else(null==a?void 0:a.status)!=="error"&&(null==a?void 0:null===(n=a.custom_set)||void 0===n?void 0:n.id)?M(a.custom_set.id):A()},[d,t,f,b,A,M]),O=(0,a.useCallback)(e=>{h(s.hi.payment.createCustomSet({arts:[e],onSuccess:U,onError:()=>{A()}}))},[h,A,U]),R=(0,a.useCallback)(e=>{h(s.hi.payment.createPodcastSet({podcastId:e,onSuccess:U,onError:()=>{A()}}))},[h,A,U]),W=(0,a.useCallback)((e,t)=>{h(s.hi.payment.createSeriesCustomSet({sequence:e,...t&&{atype:"audio"},onSuccess:U,onError:()=>{A()}}))},[h,A,U]),L=(0,a.useCallback)((e,t,r,n)=>{h(s.hi.payment.createCustomSet({arts:e,basket:!0,buy_now:t,onSuccess:a=>{var i,s,o;let{response:c}=a,u=null==c?void 0:null===(i=c.custom_set)||void 0===i?void 0:i.id;if(t)(null==c?void 0:c.status)==="error"?A(u||0):C(null==c?void 0:null===(s=c.custom_set)||void 0===s?void 0:s.id);else{let t={ref_url:P};1!==e.length||f?(null==c?void 0:null===(o=c.custom_set)||void 0===o?void 0:o.id)?(t.basket="1",t.custom_set=c.custom_set.id.toString()):(null==c?void 0:c.redirect)&&(t=F(c.redirect.location)):(t.art=e[0].toString(),t.ref_url=null!=r?r:n),b(t)}},onError:()=>{A()}}))},[h,A,C,f,b]),N=(0,a.useCallback)(()=>{if(t instanceof y.E){L(t.offeredItemsIds,t.canBeFullyPaidByAccountMoney,t.firstArtUrl,t.offerPageUrl);return}if(t instanceof m.D){W(t.seriesId,"audio"===t.artsType);return}t instanceof _.J&&t.isPodcastCollection?R(t.offeredItemsIds[0]):t instanceof _.J?O(t.offeredItemsIds[0]):t instanceof S.H?t.seriesInfo?W(t.seriesInfo.id,"audio"===t.seriesInfo.type):t.offeredItemsIds.length>1?L(t.offeredItemsIds,t.canBeFullyPaidByAccountMoney,void 0,P):O(t.offeredItemsIds[0]):(0,p.Q)("FrontendLogicError","unknown PpdOffer type for purchase in old way").emit()},[t,L,W,R,O]);return(0,a.useMemo)(()=>({purchaseInOldWay:N,paymentData:v,isOldPaymentModalOpen:B,setIsOldPaymentModalOpen:w}),[B,v,N])},F=e=>{let t=new URL(e,M()).searchParams.entries(),r={};for(let[e,n]of t)r[e]=n;return r},M=()=>o.Ym&&window.location.host.includes("litres")&&!window.location.host.includes("stage.ssr.b")?window.location.protocol+"//"+window.location.hostname:"https://www.litres.ru",U="litres_account";function x(e){let{eventType:t,customSetId:r,artsIds:n,cameFromSource:a,purchaseTraceId:i,price:s,currency:o}=e,c={purchase_trace_id:i,payment_amount:s,currency:o,payment_method_type:U,payment_system:U,integration:0,order:0,strategies:"quick_payment",source_internal:a,monetization_type:U,purchase_set_id:r,art_ids:n.join(","),save_card:!1};D.TM.sendEvent(["LITRES_TRACKER"],{eventType:t,params:c})}var O=r(20104),R=r(36513),W=r(68969),L=r(59139);let N=(0,a.forwardRef)(function(e,t){let{ppdOffer:r,canNewPaymentFrameBeUsed:u=!0,forceAuthPopupShowingForUnreg:h,alignNotificationRef:y,onErrorBuyInOldFrameOrQuickPayment:m,onSuccessPaymentViaAccount:g,onCloseOldFrameModal:k,onRetryGoingToPayment:P,onGoingToPayment:B=o.ZT,cameFromSource:b,cameFromSourcePayload:I,afterPaymentRedirectParams:D,purchaseTraceId:T}=e,S=(0,i.useDispatch)(),E=(0,c.useRouter)(),[F,M]=(0,a.useState)(!1),[U,x]=(0,a.useState)(null),W=(0,s.CG)(e=>e.face.language||o.pF.ru),L=(0,o.s7)(W),N=(0,o.XF)(W),q=(0,o.Ph)(W),Z=(0,o.P6)(W),H=N||q||Z,K=(0,a.useCallback)(()=>{x(null)},[]),z=G({isPaymentUsingLitresAccount:r.canBeFullyPaidByAccountMoney,isLanguageSuitableForNewPaymentFrame:L||H,canNewPaymentFrameBeUsed:u}),J=j(z,r instanceof _.J&&r.isPodcastCollection),Y=(0,a.useCallback)(e=>{if((0,l.HA)(e)){var t;(null===(t=e.extendedParams)||void 0===t?void 0:t.skipEmit)||e.emit({canNewPaymentFrameBeUsed:u,cameFromSource:b,isPaymentViaAccount:r.canBeFullyPaidByAccountMoney,totalPrice:r.totalPrice.value,accountMoney:r.accountMoneyInTotalPrice.value,currency:r.currency})}else(0,p.Q)("FrontendLogicError","Trying to open new payment frame",{originalError:e}).emit();x(e)},[b,u,r.accountMoneyInTotalPrice.value,r.canBeFullyPaidByAccountMoney,r.currency,r.totalPrice.value]),Q=(0,a.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;x(e),(null==D?void 0:D.failRedirectUrl)?window.location.href=D.failRedirectUrl:m&&m()},[D,m]),{isOldPaymentModalOpen:V,paymentData:X,purchaseInOldWay:ee,setIsOldPaymentModalOpen:et}=C({ppdOffer:r,cameFromSource:b,afterPaymentRedirectParams:D,purchaseTraceId:T,onCustomSetCreation:K,onErrorPayment:Q,onSuccessPaymentViaAccount:g}),er=(0,a.useCallback)(async()=>{try{let e=await $({ppdOffer:r,purchaseTraceId:T,dispatch:S,cameFromSource:b,cameFromSourcePayload:I,afterPaymentRedirectParams:D,routerQuery:E.query,shouldClearPurchaseFlowBeUsed:J});E.push(e)}catch(e){throw Y(e),e}},[D,b,I,S,Y,r,T,E,J]),en=(0,R.M)(S,!!(0,o.ej)("redeemed_promocode_jwt")||h||H),ea=(0,f.t)(),ei=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=r.canBeFullyPaidByAccountMoney&&!e&&!J;if(!ea){let e={[O.CF]:r.offerId.toString(),"block-phone-asking":"1"};(0,o.ej)("redeemed_promocode_jwt")&&(e[O.Fg]="1");let{isAuthPopupOpened:t}=en(e);if(t)return{canPay:!1}}if(t&&S(s.hi.global.modals.setGlobalModalsShowStatus("blocked")),(!r.canBeFullyPaidByAccountMoney||t)&&B(),t)return M(!0),K(),{canPay:!0};if(z)try{await er()}catch(e){return{canPay:!1}}else ee();return K(),{canPay:!0}},[r.canBeFullyPaidByAccountMoney,r.offerId,ea,z,K,en,S,B,er,ee,J]);(0,a.useImperativeHandle)(t,()=>({goToPaymentOperation:()=>({isGoingToNewPaymentFrame:z,canGoToPayment:ei(!1).then(e=>e.canPay)})}),[ei,z]);let es=(0,a.useCallback)(()=>{K(),P?P():ei(!1)},[ei,P,K]);return(0,O.$V)(r,ei,z),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(w.l,{isShown:!!U,error:U,alignElementRef:y,isOneArtPurchase:r.isOneArt,onClose:K,onRetry:es}),(0,n.jsx)(A,{isShown:F,onClose:()=>{M(!1)},onSubmit:()=>{M(!1),ei(!0)},accountMoney:r.accountMoneyInTotalPrice}),(0,n.jsx)(d.T,{isOpen:V,onClose:()=>{et(!1),null==k||k()},onShow:()=>{et(!1)},onHide:()=>{et(!0),null==k||k()},paymentData:X}),(0,n.jsx)(v.r,{artIds:r.offeredItemsIds})]})});async function $(e){let{ppdOffer:t,dispatch:r,cameFromSource:n,cameFromSourcePayload:a,purchaseTraceId:i,afterPaymentRedirectParams:o,routerQuery:c,shouldClearPurchaseFlowBeUsed:u}=e,d=null!=i?i:k.q.createPurchaseTraceId();if(u)try{L.k.trackStart({cameFromSource:n,offerType:t.offerType,purchaseTraceId:d});let e=await new k.q(r).execute({cameFromSource:n,offer:t,purchaseTraceId:d}),i=new P._({adaptedOrderBackendInfo:e});return L.k.trackSuccess({cameFromSource:n,offerType:t.offerType,purchaseTraceId:d,orderId:i.id}),(0,W.x)({orderInfo:i,afterPaymentRedirectParams:o,cameFromSourcePayload:a,routerQuery:c})}catch(e){var f;if(!((0,l.HA)(e)&&(null===(f=e.extendedParams)||void 0===f?void 0:f.skipEmit))){let r="unknown";(0,l.HA)(e)&&(0,l.i3)(e.originalError)?r=e.originalError.data.error.type:(0,l.HA)(e)&&(0,l.p3)(e.originalError)?r=e.originalError.data:(0,l.HA)(e)&&(0,l.V3)(e.originalError)&&(r=e.originalError.name),L.k.trackError({cameFromSource:n,offerType:t.offerType,purchaseTraceId:d,errorName:r})}throw e}else{let e=null;if(t instanceof y.E?e={from_cart:!0}:t instanceof m.D?e={series:{id:t.seriesId,type:"audio"===t.artsType?1:0}}:t instanceof g.i?e={book_audiobook_bundle:{art_ids:t.offeredItemsIds,type:"audio"===t.sourceArtType?1:0}}:t instanceof _.J?e=t.isPodcastCollection?{podcast:{id:t.offeredItemsIds[0]}}:{art_ids:t.offeredItemsIds}:t instanceof B.s&&(e={art_ids:t.offeredItemsIds,...!!t.packPresaleType&&{upsale:{type:t.packPresaleType,art_ids:t.offeredItemsIds}}}),!e){let e=(0,p.Q)("FrontendLogicError","Unknown PpdOffer type for payment in new frame");throw e.emit(),e}let i=await r(s.fR.endpoints.createPurchaseSet.initiate(e));if((0,h.$)(i)){let{error:e}=i;throw(0,p.Q)("BackendInteractionError","Cannot go to ppd payment",{originalError:e})}let u={"purchase-set":i.data.id.toString()};return(0,W.h)({paymentOperation:"ppd",purchaseTraceId:d,cameFromSource:n,cameFromSourcePayload:a,afterPaymentRedirectParams:o,routerQuery:c,specificPaymentOperationUrlParams:u})}}let G=e=>{let{isPaymentUsingLitresAccount:t,isLanguageSuitableForNewPaymentFrame:r,canNewPaymentFrameBeUsed:n}=e,a=(0,c.useRouter)(),s=0!==(0,i.useSelector)(e=>e.foundationUser).id,o=q();return!!(s&&n&&(r||a.query.openNewPayment)&&(!t||o)&&!a.query["old-payment"])},j=(e,t)=>{let r=q();return e&&r&&!t};function q(){let e=(0,u.bi)("New_purchase","1");return"1"===(0,c.useRouter)().query.new_purchase||e}},59139:function(e,t,r){"use strict";r.d(t,{k:function(){return a}});var n=r(44731);let a={trackStart:function(e){n.TM.sendEvent(["LITRES_TRACKER"],{eventType:"order_creation_start",params:{purchase_trace_id:e.purchaseTraceId,offer_type:e.offerType,purchase_operation_type:"ppd",source_internal:e.cameFromSource}})},trackError:function(e){n.TM.sendEvent(["LITRES_TRACKER"],{eventType:"order_creation_error",params:{purchase_trace_id:e.purchaseTraceId,offer_type:e.offerType,purchase_operation_type:"ppd",source_internal:e.cameFromSource,error_name:e.errorName}})},trackSuccess:function(e){n.TM.sendEvent(["LITRES_TRACKER"],{eventType:"order_creation_success",params:{purchase_trace_id:e.purchaseTraceId,offer_type:e.offerType,purchase_operation_type:"ppd",source_internal:e.cameFromSource,orderId:e.orderId}})}}},20104:function(e,t,r){"use strict";r.d(t,{$V:function(){return m},CF:function(){return f},Fg:function(){return p}});var n=r(26249),a=r(44194),i=r(61794),s=r(58117),o=r(78265),c=r(97439),u=r(49996),l=r(89668);let d="go-to-ppd-payment",h=c.pi.buy_now,f="go-to-ppd-payment-for",p="only-if-promocode-activated",y=!1;function m(e,t,r){let m=(0,n.useRouter)(),[{activatedPromocode:_,persistedPromocode:g}]=(0,o.z)(),v=(0,i.TL)();(0,a.useEffect)(()=>{if(y)return;let n=m.asPath.split("#")[1],a=(null==n?void 0:n.includes(h))||(null==n?void 0:n.includes(c.pi.buy_now_reg))||!!m.query[d],o=m.query[f];if(a){let t=-1;e instanceof u.x&&(t=e.offeredItemsIds[0]),e instanceof l.o&&(t=e.offeredArtId),o=t.toString(),v(i.hi.global.modals.setGlobalModalsShowStatus("blocked"))}let k=!!m.query[p];o&&e.offerId===o&&(!k||_&&(null==g?void 0:g.isRedeemed))&&(y=!0,(0,s.Ow)(m,[d,f,p,"block-phone-asking"],!!m.query.promocode),r?t(!1,!0):setTimeout(()=>{t(!1,!0)},1e3))},[e.offerId,_,null==g?void 0:g.isRedeemed])}},36513:function(e,t,r){"use strict";r.d(t,{M:function(){return o}});var n=r(44194),a=r(61794),i=r(48592),s=r(15381);let o=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{t:r}=(0,i.$G)(),a=u();return(0,n.useCallback)(n=>{let i=t||"no-authorization"!==a;return i&&c(r)(e,a,n),{isAuthPopupOpened:i}},[e,a,t])},c=e=>(t,r,n,i)=>{let{fullScreen:s,noCancel:o,phoneFirst:c}={fullScreen:r.includes("fullscreen"),popup:r.includes("popup"),cancel:r.includes("cancel"),noCancel:r.includes("nocancel"),phoneFirst:r.includes("phonefirst"),emailFirst:r.includes("emailfirst")};t(a.hi.global.interfaceRequests.setLoginPopupError({isOpen:!0,uiOptions:{fullScreen:s,noCancel:o,phoneFirst:c},errorText:e("Авторизуйтесь для покупки"),urlParams:n,onHide:i}))},u=()=>(0,s.t)()?"no-authorization":"popup-cancel-emailfirst"},29566:function(e,t,r){"use strict";var n,a;r.d(t,{s:function(){return n}}),(a=n||(n={})).paymentStart="payment_start",a.clickPaymentContinue="click_payment_continue",a.paymentMethodChange="payment_method_change",a.clickRussianCardPayment="payment_russian_card_click",a.clickRussianForeignPayment="payment_foreign_card_click",a.receiptEmailChangeStart="receipt_email_change_start",a.receiptEmailChangeEnd="receipt_email_change_end",a.showOldPaymentFrameClick="show_old_payment_frame_click",a.closeOldPaymentFrameClick="close_old_payment_frame_click",a.paymentFailed="payment_failed",a.clickOtherMethodFailed="click_other_method_failed",a.clickBackFailed="click_back_failed",a.paymentSuccess="payment_success",a.paymentGtmSendingError="payment_gtm_sending_error",a.orderCreationSuccess="order_creation_success",a.orderCreationError="order_creation_error"},59187:function(e,t,r){"use strict";r.d(t,{r:function(){return f}});var n=r(31549),a=r(56321),i=r(44194),s=r(62094),o=r(96780),c=r(48592),u=r(30458),l=r.n(u);let d=e=>{let{t}=(0,c.$G)(),r=t("Обновляем страницу после успешной покупки"),{message:a=r}=e;return(0,n.jsxs)("div",{className:l().root,children:[(0,n.jsx)("p",{className:l().message,children:a}),(0,n.jsx)(o.$,{})]})};var h=r(29093);let f=e=>{let[t]=(0,i.useState)(()=>{var t;return Array.isArray(t=e.artIds)?(0,h.s)(t):[t]}),[r,o]=(0,i.useState)(!1),c=(0,s.uH)(),u=(0,i.useCallback)(()=>{window.beforeReloadPageAfterSuccessPurchaseComplete||(window.beforeReloadPageAfterSuccessPurchaseComplete=1,o(!0))},[]);return((0,h.n)(t,u),c&&r)?(0,a.createPortal)((0,n.jsx)(d,{message:e.overlayMessage}),document.body):null}},29093:function(e,t,r){"use strict";r.d(t,{n:function(){return i},s:function(){return s}});var n=r(44194),a=r(46987);let i=(e,t)=>{let r=(0,n.useRef)(!1),i=(0,n.useRef)(t);i.current!==t&&(i.current=t),(0,n.useEffect)(()=>{let t=()=>{"visible"===document.visibilityState&&r.current&&(i.current(),setTimeout(()=>{window.location.reload()},400))},n=a.P.subscribeToTabEventBus("success_purchase",t=>{e.some(e=>t.includes(e))&&(r.current=!0)});return document.addEventListener("visibilitychange",t),()=>{n(),document.removeEventListener("visibilitychange",t)}},[e])};function s(e){return e.length>10?e.slice(0,10):e}},46987:function(e,t,r){"use strict";r.d(t,{P:function(){return a}});class n{messageListener(e){let t=e.data;this.listeners.forEach(e=>{e(t)})}errorListener(e){console.error("[TabEventBus] Сообщение не может быть клонировано и передано через канал",e.data)}createChannel(e){if("BroadcastChannel"in window)try{return new BroadcastChannel(e)}catch(e){return console.error("[TabEventBus] Возникла ошибка при создании BroadcastChannel",e),null}return console.error("[TabEventBus] BroadcastChannel API не поддерживается в этом окружении"),null}sendMessage(e){if(!this.channel){console.warn("[TabEventBus] Канал недоступен");return}this.channel.postMessage(e)}subscribeToEvent(e){return this.channel?(this.listeners.add(e),()=>{this.listeners.delete(e),0===this.listeners.size&&this.closeChannel()}):(console.warn("[TabEventBus] Канал недоступен. Подписка добавлена не будет."),()=>{})}closeChannel(){this.channel&&(this.channel.removeEventListener("message",this.messageListener),this.channel.removeEventListener("messageerror",this.errorListener),this.channel.close(),this.channel=null)}clear(){this.listeners=new Set,this.closeChannel()}constructor(e){var t,r;this.channel=this.createChannel(e),this.listeners=new Set,this.boundMessageListener=this.messageListener.bind(this),this.boundErrorListener=this.errorListener.bind(this),null===(t=this.channel)||void 0===t||t.addEventListener("message",this.boundMessageListener),null===(r=this.channel)||void 0===r||r.addEventListener("messageerror",this.boundErrorListener)}}class a{static getChannelByName(e){if(!a.channels.has(e)){let t=new n(e);a.channels.set(e,t)}return a.channels.get(e)}static subscribeToTabEventBus(e,t){let r=this.getChannelByName(e);if(r){let n=r.subscribeToEvent(e=>{t(e)});return()=>{n(),0===r.listeners.size&&a.channels.delete(e)}}return()=>{}}static sendMessage(e,t){let r=this.getChannelByName(e);null==r||r.sendMessage(t)}static deleteByName(e){a.channels.has(e)&&(a.getChannelByName(e).clear(),a.channels.delete(e))}static reset(){for(let e of a.channels.values())e.clear();a.channels=new Map}static get size(){return a.channels.size}}a.channels=new Map},81014:function(e,t,r){"use strict";r.d(t,{W:function(){return i}});var n=r(5939);let a={AZN:"₼",BYN:"Br",CAD:"$",CHF:"CHF",CNY:"\xa5",CZK:"Kč",DKK:"kr",EUR:"€",GBP:"\xa3",JPY:"\xa5",KZT:"₸",MDL:"lei",NOK:"kr",PLN:"zł",AUD:"$",SEK:"kr",SGD:"S$",TRY:"₺",UAH:"₴",USD:"$",UZS:"s`om",RUB:"₽"};class i extends n.D{toString(){return this.getFormattedValue()}toStringWithCurrency(){let e="",t=this.getFormattedValue();return("-"===t[0]&&(e="-",t=t.slice(1)),"right"===this.getCurrencyPosition())?"".concat(e).concat(t," ").concat(this.currencySymbol):"".concat(e).concat(this.currencySymbol).concat(t)}getCurrencyPosition(){switch(this.currency){case"RUB":case"UZS":case"AZN":case"PLN":return"right";default:return"left"}}getFormattedValue(){let e=this.getThousandsSeparator(),t=this.getDecimalSeparator(),r=this.getFractionDigits(),n=this.value.toFixed(r).split(".");return n[0]=i.separateThousands(n[0],e),n.join(t)}getThousandsSeparator(){switch(this.currency){case"RUB":case"UZS":case"AZN":case"PLN":return" ";case"USD":return",";default:return"."}}getDecimalSeparator(){return"USD"===this.currency?".":","}getFractionDigits(){return Number.isInteger(this.value)?0:2}static separateThousands(e,t){return e.replace(/\B(?=(\d{3})+(?!\d))/g,t)}constructor(e,t){"number"==typeof e?(super(e),this.currency=t):(super(e.amount),this.currency=e.currency),this.currencySymbol=a[this.currency]}}},5939:function(e,t,r){"use strict";r.d(t,{D:function(){return n}});class n{equal(e){return this.value===e.value}greaterThen(e){return this.value>e.value}lesserThen(e){return this.value<e.value}checkIfZero(){return 0===this.value}checkIfPositive(){return this.value>0}checkIfNegative(){return this.value>0}checkIfPositiveOrZero(){return this.checkIfPositive()||this.checkIfZero()}checkIfNegativeOrZero(){return this.checkIfNegative()||this.checkIfZero()}checkIfMoreThanOne(){return this.value>1}checkIfOne(){return 1===this.value}constructor(e){this.value=e}}},52887:function(e,t,r){"use strict";r.d(t,{$:function(){return a},G:function(){return i}});var n=r(5939);class a extends n.D{toStringWithSymbol(){return"".concat(this.value,"%")}}function i(e,t){return new a(Math.round((e-t)/e*100))}},35660:function(e){e.exports={payment__inner:"OldPaymentModal-module__gaJ9gq__payment__inner",payment:"OldPaymentModal-module__gaJ9gq__payment"}},21958:function(e){e.exports={tryAgain:"ErrorNotification-module__Rifmba__tryAgain"}},30458:function(e){e.exports={root:"Overlay-module__DGQmsa__root",message:"Overlay-module__DGQmsa__message"}}}]);
//# sourceMappingURL=8505-bdc76973ad4d3c5b.js.map